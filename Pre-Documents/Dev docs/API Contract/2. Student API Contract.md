## 📘 API Contract — `Student Module`

> Version: `v1`  
> Base Path: `/api/v1/students`  
> Auth Required: ✅ Yes (JWT)  
> Roles Permitted: **SuperAdmin**, **Admin**, **Teacher** (contextual), **Parent** (linked), **Student** (self-only)

---

### 🔐 Access Control Rules

|Action|Role|Scope|
|---|---|---|
|List students|SuperAdmin, Admin|All students|
|Create student|SuperAdmin, Admin|Full creation|
|Get student by ID|SuperAdmin, Admin, Parent, Student|Self or linked child|
|Update student|SuperAdmin, Admin|All students|
|Delete (soft) student|SuperAdmin, Admin|All students|
|View own profile|Student|Self|
|View linked-child profile|Parent|Linked children|
|Teachers view own students|Teacher|Students of assigned classes/sections|

---

### 📚 Endpoint Catalog

|Method|Path|Description|Auth & Roles|
|---|---|---|---|
|**GET**|`/students`|List students — supports filters & **pagination (`limit` ≤ 200)**|Admin/SuperAdmin|
|**POST**|`/students`|Create a new student record|Admin/SuperAdmin|
|**GET**|`/students/:id`|Get full student record|Admin/SuperAdmin/Parent/Student/Teacher|
|**PUT**|`/students/:id`|Partially update student details|Admin/SuperAdmin|
|**DELETE**|`/students/:id`|Soft-delete student|Admin/SuperAdmin|
|**GET**|`/students/:id/profile`|Get student profile info|Admin/Parent/Student/Teacher|
|**POST**|`/students/search`|Advanced search (filtered & **paginated**)|Admin/SuperAdmin|

---

### 🧾 TypeScript Schemas

#### 🛠️ `CreateStudentRequest`

```ts
interface CreateStudentRequest {
  user: {
    full_name: string;
    email: string;
    phone?: string;
    password: string;
  };
  class_id: string;          // UUID → academics.classes.id
  section_id: string;        // UUID → academics.sections.id
  roll_number: string;
  dob: string;               // ISO (YYYY-MM-DD)
  gender: 'male' | 'female' | 'other';
  additional_metadata?: Record<string, any>;
}
```

#### ✅ `StudentResponse`

```ts
interface StudentResponse {
  id: string;
  user_id: string;
  full_name: string;
  email: string;
  phone?: string;
  class_id: string;
  section_id: string;
  roll_number: string;
  dob: string;
  gender: 'male' | 'female' | 'other';
  /** aggregated exam result (optional, numeric in DB) */
  marks_obtained?: number;     // <-- Schema-API drift fixed (number)
  additional_metadata?: Record<string, any>;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

#### 🛠️ `UpdateStudentRequest`

```ts
interface UpdateStudentRequest {
  full_name?: string;
  phone?: string;
  class_id?: string;
  section_id?: string;
  roll_number?: string;
  dob?: string;
  gender?: 'male' | 'female' | 'other';
  additional_metadata?: Record<string, any>;
}
```

#### 🔍 `SearchStudentsRequest`

```ts
interface SearchStudentsRequest {
  full_name?: string;
  class_id?: string;
  section_id?: string;
  roll_number?: string;
  gender?: 'male' | 'female' | 'other';
  dob_from?: string;   // ISO date
  dob_to?: string;     // ISO date
  /** pagination (guarded) */
  page?: number;       // default 1
  limit?: number;      // default 50, max 200
}
```

> **Server-side guard**
> 
> ```ts
> const querySchema = Joi.object({
>   page:  Joi.number().min(1).default(1),
>   limit: Joi.number().max(200).default(50)
> });
> ```

#### 📦 `PaginatedStudentsResponse`

```ts
interface PaginatedStudentsResponse {
  data:  StudentResponse[];
  page:  number;
  limit: number;
  total: number;
}
```

---

### ⚠️ Standard Error Object

```ts
interface ErrorResponse {
  statusCode: number;
  error: string;          // e.g. "Not Found"
  message: string;        // Human-readable
  code?: string;          // STUDENT_NOT_FOUND, DUPLICATE_ROLL_NUMBER …
}
```

---

### 🔐 Security Headers

```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
X-Request-ID: <uuid>      # tracing (client-supplied)
```

---

### 🔗 Notes on Relations

- `class_id`, `section_id` → `academics.classes.id`, `academics.sections.id`
    
- Students link to users via `user_id`
    
- `marks_obtained` is **numeric** in DB & API to avoid type-cast bugs
    
- List/search endpoints **enforce max limit 200** (default 50)
    
- Soft delete flagged by `deleted_at` ≠ null
    

---

### ✅ Role Constraints + Guards

_Admin / SuperAdmin_ – full CRUD  
_Teacher_ – read only for own class/section  
_Parent_ – read linked child records  
_Student_ – read self only

---

### 📋 Sample Flows

#### 1 · Create Student

`POST /students` → body: `CreateStudentRequest` → returns `StudentResponse`

#### 2 · Update Student

`PUT /students/:id` → body: `UpdateStudentRequest`

#### 3 · Fetch Own Profile

`GET /students/:own_id/profile` → returns full `StudentResponse`

---