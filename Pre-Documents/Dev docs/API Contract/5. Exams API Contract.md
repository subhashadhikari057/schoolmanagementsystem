
## 📘 API Contract — `Exams Module`

> Version: `v1`  
> Base Path: `/api/v1/exams`  
> Auth Required: ✅ Yes (JWT)  
> Roles Permitted: **SuperAdmin**, **Admin**, **Teacher**, **Student**, **Parent** (view-only)

---

### 🔐 Access Control Rules

|Action|Role|Scope|
|---|---|---|
|List exams|Admin, SuperAdmin, Teacher|All exams|
|Create exam|Admin, SuperAdmin|Full creation|
|View exam by ID|All roles (contextual)|Based on role + enrolment|
|Update exam|Admin, SuperAdmin|All editable fields|
|Delete exam (soft)|Admin, SuperAdmin|Logical removal|
|List exam sessions|Admin, SuperAdmin, Teacher|All sessions for an exam|
|Submit exam results|Teacher|Assigned classes / subjects|
|View results|Student, Parent, Teacher, Admin|Filtered per role|
|Update result|Admin, Teacher (assigned)|Correction scenarios|
|View grades & grading policy|All roles (contextual)|By academic year / class|

---

## 🧭 Sub-module Routing

|Sub-module|Path|Purpose|
|---|---|---|
|**exams**|`/exams`|Core exam definitions|
|**exam_sessions**|`/exams/:exam_id/sessions`|Scheduling per exam|
|**results**|`/exams/:exam_id/results`|Marks entry & report cards|
|**grades**|`/grades`|Global / year grading scales|

---

### 📚 Endpoint Catalog

#### 🧪 Exams

|Method|Path|Description|Roles|
|---|---|---|---|
|GET|`/exams`|List exams (filterable by `term`, `academic_year_id`)|Admin, SuperAdmin, Teacher|
|POST|`/exams`|Create exam — **must include** `term`, `academic_year_id`|Admin, SuperAdmin|
|GET|`/exams/:id`|Get exam by ID|All contextual roles|
|PUT|`/exams/:id`|Update exam|Admin, SuperAdmin|
|DELETE|`/exams/:id`|Soft-delete exam|Admin, SuperAdmin|

#### ⏱️ Exam Sessions

|Method|Path|Description|Roles|
|---|---|---|---|
|GET|`/exams/:exam_id/sessions`|List sessions for an exam|Admin, Teacher|
|POST|`/exams/:exam_id/sessions`|Create session for a subject|Admin|
|PUT|`/exams/:exam_id/sessions/:session_id`|Update session|Admin|
|DELETE|`/exams/:exam_id/sessions/:session_id`|Delete session|Admin|

#### 📊 Results

|Method|Path|Description|Roles|
|---|---|---|---|
|GET|`/exams/:exam_id/results`|List results (filter by student)|Admin, Teacher, Student, Parent|
|POST|`/exams/:exam_id/results`|Submit marks|Teacher|
|PUT|`/exams/:exam_id/results/:result_id`|Update a result|Admin, Teacher|
|GET|`/exams/:exam_id/results/:result_id`|View result entry|All contextual roles|

#### 🧮 Grades

|Method|Path|Description|Roles|
|---|---|---|---|
|GET|`/grades`|List grading scales|All authenticated|
|POST|`/grades`|Create grade range|Admin, SuperAdmin|
|PUT|`/grades/:id`|Update grade thresholds|Admin, SuperAdmin|
|DELETE|`/grades/:id`|Remove grade range|Admin, SuperAdmin|

---

### 🧾 TypeScript Schemas

#### 🛠️ `CreateExamRequest`

```ts
interface CreateExamRequest {
  title: string;
  academic_year_id: string;                  // top-level for filters & reports
  term: 'first' | 'second' | 'final' | string;
  start_date: string;                        // ISO - YYYY-MM-DD
  end_date: string;                          // ISO
  metadata?: Record<string, any>;            // optional extras
}
```

> **Important:** `term` & `academic_year_id` **must not** be tucked inside `metadata`; they power list filters, dashboards, and analytics.

---

#### ✅ `ExamResponse`

```ts
interface ExamResponse {
  id: string;
  title: string;
  academic_year_id: string;
  term: string;
  start_date: string;
  end_date: string;
  metadata?: Record<string, any>;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

---

#### 🛠️ `CreateExamSessionRequest`

```ts
interface CreateExamSessionRequest {
  subject_id: string;
  class_id: string;
  section_id: string;
  date: string;        // ISO date
  start_time: string;  // HH:MM
  end_time: string;    // HH:MM
  room?: string;
}
```

#### ✅ `ExamSessionResponse`

```ts
interface ExamSessionResponse {
  id: string;
  exam_id: string;
  subject_id: string;
  class_id: string;
  section_id: string;
  date: string;
  start_time: string;
  end_time: string;
  room?: string;
  created_at: string;
}
```

---

#### 🛠️ `SubmitResultRequest`

```ts
interface SubmitResultRequest {
  student_id: string;
  subject_id: string;
  marks_obtained: number;
  max_marks: number;
  remarks?: string;
}
```

#### ✅ `ResultResponse`

```ts
interface ResultResponse {
  id: string;
  exam_id: string;
  student_id: string;
  subject_id: string;
  marks_obtained: number;
  max_marks: number;
  grade?: string;          // derived
  remarks?: string;
  created_at: string;
  updated_at: string;
}
```

---

#### 🛠️ `CreateGradeRequest`

```ts
interface CreateGradeRequest {
  min_score: number;
  max_score: number;
  grade: string;           // e.g. A+, B
  description?: string;
}
```

#### ✅ `GradeResponse`

```ts
interface GradeResponse {
  id: string;
  min_score: number;
  max_score: number;
  grade: string;
  description?: string;
  created_at: string;
}
```

---

### ⚠️ Standard Error Object

```ts
interface ErrorResponse {
  statusCode: number;
  error: string;
  message: string;
  code?: string;           // e.g. EXAM_NOT_FOUND
}
```

---

### 🔐 Security Headers

```http
Authorization: Bearer <JWT>
Content-Type: application/json
X-Request-ID: <uuid>
```

---

### 🔗 Schema Relations

- `exam_sessions` → `exams.id`, `subjects.id`, `classes.id`, `sections.id`
    
- `results` link `exam_id` + `student_id` + `subject_id`
    
- `grades` often scoped by `academic_year_id`
    

Teachers may only touch results for subjects/classes they teach.

---

### 🚫 Metadata Field Caution

Fields that drive UI filters (e.g., `term`, `academic_year_id`, `grading_policy`) **belong in first-class columns**, **not** hidden in `metadata`.  
Doing so enables:

- Query: `GET /exams?term=final&academic_year_id=xyz`
    
- Dashboard group-bys
    
- Consistent analytics & reporting
    

---

### ✅ Role Constraints

|Role|Capabilities|
|---|---|
|Admin / SuperAdmin|Full CRUD on exams, sessions, results, grades|
|Teacher|Manage sessions/results for own subjects|
|Student|View own results|
|Parent|View child results|

---

### 📋 Sample Flows

1. **Create Exam**
    

```http
POST /exams
```

Body → `CreateExamRequest` → returns `ExamResponse`.

2. **Schedule Session**
    

```http
POST /exams/{exam_id}/sessions
```

Body → `CreateExamSessionRequest`.

3. **Submit Results**
    

```http
POST /exams/{exam_id}/results
```

Body → array of `SubmitResultRequest` → returns `ResultResponse[]`.

4. **Student Views Own Results**
    

```http
GET /exams/{exam_id}/results?student_id=me
```

Returns `ResultResponse[]`.

---
