---

## üìò API Contract ‚Äî `Configuration Module`

> Version: `v1`  
> Base Path: `/api/v1/configuration`  
> Auth Required: ‚úÖ Yes (JWT)  
> Roles Permitted: **SuperAdmin**, **Admin**

---

### üîê Access Control Rules

| Action                                 | Role(s)           | Scope                 |
| -------------------------------------- | ----------------- | --------------------- |
| Get school profile                     | Admin, SuperAdmin | Entire school profile |
| Update school profile                  | Admin, SuperAdmin | Entire school profile |
| List academic years                    | Admin, SuperAdmin | All academic years    |
| Create / update / delete academic year | Admin, SuperAdmin | Full CRUD             |
| List grading policies                  | Admin, SuperAdmin | All                   |
| Manage grading policies                | Admin, SuperAdmin | Full CRUD             |
| List subject mappings                  | Admin, SuperAdmin | All                   |
| Manage subject mappings                | Admin, SuperAdmin | Full CRUD             |

---

### üìö Endpoint Catalog

| Method     | Path                    | Description                 | Auth & Roles      |
| ---------- | ----------------------- | --------------------------- | ----------------- |
| **GET**    | `/school-profile`       | Current school profile      | Admin, SuperAdmin |
| **PUT**    | `/school-profile`       | Update school profile       | Admin, SuperAdmin |
| **GET**    | `/academic-years`       | List academic years         | Admin, SuperAdmin |
| **POST**   | `/academic-years`       | Create academic year        | Admin, SuperAdmin |
| **GET**    | `/academic-years/:id`   | Academic year by ID         | Admin, SuperAdmin |
| **PUT**    | `/academic-years/:id`   | Update academic year        | Admin, SuperAdmin |
| **DELETE** | `/academic-years/:id`   | Soft-delete academic year   | Admin, SuperAdmin |
| **GET**    | `/grading-policies`     | List grading policies       | Admin, SuperAdmin |
| **POST**   | `/grading-policies`     | Create grading policy       | Admin, SuperAdmin |
| **GET**    | `/grading-policies/:id` | Grading policy by ID        | Admin, SuperAdmin |
| **PUT**    | `/grading-policies/:id` | Update grading policy       | Admin, SuperAdmin |
| **DELETE** | `/grading-policies/:id` | Soft-delete grading policy  | Admin, SuperAdmin |
| **GET**    | `/subject-mappings`     | List subject mappings       | Admin, SuperAdmin |
| **POST**   | `/subject-mappings`     | Create subject mapping      | Admin, SuperAdmin |
| **GET**    | `/subject-mappings/:id` | Subject mapping by ID       | Admin, SuperAdmin |
| **PUT**    | `/subject-mappings/:id` | Update subject mapping      | Admin, SuperAdmin |
| **DELETE** | `/subject-mappings/:id` | Soft-delete subject mapping | Admin, SuperAdmin |

---

### üßæ TypeScript Schemas

> **Key / Value Alignment Notice**  
> Any table or API that stores arbitrary settings **must expose `config_type` and `default_value`** with explicit types that match the DB (`config_type` ‚Üí `VARCHAR(30)` or ENUM, `default_value` ‚Üí `JSONB` / strict scalar column). Never overload `additional_metadata` for core keys.

---

#### ‚úÖ `SchoolProfileResponse`

```ts
interface SchoolProfileResponse {
  id: string;
  name: string;
  address: string;
  phone: string;
  email: string;
  website?: string;
  logo_url?: string;
  established_year?: number;
  additional_metadata?: Record<string, unknown>; // non-core only
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

#### ‚úÖ `UpdateSchoolProfileRequest`

```ts
interface UpdateSchoolProfileRequest {
  name?: string;
  address?: string;
  phone?: string;
  email?: string;
  website?: string;
  logo_url?: string;
  established_year?: number;
  additional_metadata?: Record<string, unknown>;
}
```

---

#### ‚úÖ `AcademicYearRequest`

```ts
interface AcademicYearRequest {
  name: string; // "2024-2025"
  start_date: string; // YYYY-MM-DD
  end_date: string; // YYYY-MM-DD
  is_active: boolean;
  additional_metadata?: Record<string, unknown>;
}
```

#### ‚úÖ `AcademicYearResponse`

```ts
interface AcademicYearResponse {
  id: string;
  name: string;
  start_date: string;
  end_date: string;
  is_active: boolean;
  additional_metadata?: Record<string, unknown>;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

---

#### ‚úÖ `GradingPolicyRequest`

```ts
interface GradingPolicyRequest {
  name: string;
  description?: string;
  grade_scale: {
    grade: string; // e.g. "A+"
    min_percentage: number; // 0‚Äì100
    max_percentage: number; // 0‚Äì100
    remarks?: string;
  }[];
  additional_metadata?: Record<string, unknown>;
}
```

#### ‚úÖ `GradingPolicyResponse`

```ts
interface GradingPolicyResponse {
  id: string;
  name: string;
  description?: string;
  grade_scale: {
    grade: string;
    min_percentage: number;
    max_percentage: number;
    remarks?: string;
  }[];
  additional_metadata?: Record<string, unknown>;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

---

#### ‚úÖ `SubjectMappingRequest`

```ts
interface SubjectMappingRequest {
  subject_id: string; // FK ‚Üí academics.subjects.id
  external_code: string; // VARCHAR(30) in DB
  description?: string;
  additional_metadata?: Record<string, unknown>;
}
```

#### ‚úÖ `SubjectMappingResponse`

```ts
interface SubjectMappingResponse {
  id: string;
  subject_id: string;
  external_code: string;
  description?: string;
  additional_metadata?: Record<string, unknown>;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

---

### ‚ö†Ô∏è Standard Error Object

```ts
interface ErrorResponse {
  statusCode: number;
  error: string;
  message: string;
  code?: string; // NOT_FOUND, VALIDATION_ERROR, etc.
}
```

---

### üîê Security Headers

```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
X-Request-ID: <uuid>
```

---

### üîó Notes on Type Consistency

- **Do _not_ hide core fields in `additional_metadata`.**  
   Promote anything needed for UI filtering or business logic (e.g. `external_code`, `is_active`, `grade_scale`) to proper columns / root-level API keys.
- **Example DDL alignment**

```sql
-- Ensure strict typing of key/value pairs
ALTER TABLE configuration.global_settings
  ALTER COLUMN config_type TYPE VARCHAR(30),
  ALTER COLUMN default_value TYPE JSONB;
```

- **Validation** ‚Äì backend serializers (e.g. Zod/Joi) must enforce the exact types above; mismatches should return **HTTP 400**.

---

### ‚úÖ Role Constraints

| Role                   | Capabilities                                   |
| ---------------------- | ---------------------------------------------- |
| **SuperAdmin / Admin** | Full read/write on all configuration resources |
| **Others**             | No access                                      |

---

### üìã Sample Flows

#### 1 ‚Ä¢ Create Academic Year

```http
POST /academic-years
Content-Type: application/json
Authorization: Bearer <token>

{
  "name": "2025-2026",
  "start_date": "2025-09-01",
  "end_date": "2026-06-30",
  "is_active": true
}
```

Returns ‚Üí `AcademicYearResponse` with correct boolean `is_active`.

---

#### 2 ‚Ä¢ Create Subject Mapping

```http
POST /subject-mappings

{
  "subject_id": "subj-uuid",
  "external_code": "PHY-11",
  "description": "Physics Grade 11"
}
```

`external_code` is `VARCHAR(30)` in DB and `string` in API ‚Äî perfectly aligned.

---
