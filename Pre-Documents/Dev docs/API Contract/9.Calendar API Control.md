Below is the **fully updated `9. Calendar API Contract.md`** with **uniform `start_time` / `end_time` usage** throughout.  
Copy-paste ready.

---

## 📘 API Contract — `Calendar Module`

> Version: `v1`  
> Base Path: `/api/v1/calendar`  
> Auth Required: ✅ Yes (JWT)  
> Roles Permitted: **SuperAdmin**, **Admin**, **Teacher**, **Parent**, **Student**

---

### 🔐 Access Control Rules

| Action                          | Role(s)                    | Scope                                               |
| ------------------------------- | -------------------------- | --------------------------------------------------- |
| List calendar events            | All authenticated          | Events visible to the user’s role / class / section |
| Create calendar event           | Admin, SuperAdmin, Teacher | School-wide or targeted classes / sections          |
| Get event by ID                 | All authenticated          | If user has access                                  |
| Update calendar event           | Admin, SuperAdmin, Teacher | Events the user created / manages                   |
| Delete calendar event (soft)    | Admin, SuperAdmin, Teacher | Same as above                                       |
| List event participants         | Admin, SuperAdmin, Teacher | For a given event                                   |
| Add / remove event participants | Admin, SuperAdmin, Teacher | Manage participant list                             |
| Get school-day configuration    | Admin, SuperAdmin          | Academic-year calendar config                       |
| Update school-day configuration | Admin, SuperAdmin          | Modify config                                       |

---

### 📚 Endpoint Catalog

| Method     | Path                                | Description                                                             | Auth & Roles               |
| ---------- | ----------------------------------- | ----------------------------------------------------------------------- | -------------------------- |
| **GET**    | `/events`                           | List events (filterable; **all time fields = `start_time`/`end_time`**) | All                        |
| **POST**   | `/events`                           | Create calendar event                                                   | Admin, SuperAdmin, Teacher |
| **GET**    | `/events/:id`                       | Event details                                                           | All                        |
| **PUT**    | `/events/:id`                       | Update calendar event                                                   | Admin, SuperAdmin, Teacher |
| **DELETE** | `/events/:id`                       | Soft-delete event                                                       | Admin, SuperAdmin, Teacher |
| **GET**    | `/events/:id/participants`          | List participants                                                       | Admin, SuperAdmin, Teacher |
| **POST**   | `/events/:id/participants`          | Add participants                                                        | Admin, SuperAdmin, Teacher |
| **DELETE** | `/events/:id/participants/:user_id` | Remove participant                                                      | Admin, SuperAdmin, Teacher |
| **GET**    | `/school-day-config`                | Current school-day config                                               | Admin, SuperAdmin          |
| **PUT**    | `/school-day-config`                | Update school-day config                                                | Admin, SuperAdmin          |

---

### 🧾 TypeScript Schemas

_All date-time strings are ISO-8601._

#### 🛠️ `CreateCalendarEventRequest`

```ts
interface CreateCalendarEventRequest {
  title: string;
  description?: string;
  start_time: string; // ISO 8601
  end_time: string; // ISO 8601
  location?: string;
  event_type: "holiday" | "exam" | "meeting" | "other";
  target_roles?: ("Student" | "Teacher" | "Parent" | "Admin" | "SuperAdmin")[];
  target_classes?: string[];
  target_sections?: string[];
  is_all_day?: boolean;
  metadata?: Record<string, any>;
}
```

#### ✅ `CalendarEventResponse`

```ts
interface CalendarEventResponse {
  id: string;
  title: string;
  description?: string;
  start_time: string;
  end_time: string;
  location?: string;
  event_type: "holiday" | "exam" | "meeting" | "other";
  target_roles: string[];
  target_classes?: string[];
  target_sections?: string[];
  is_all_day: boolean;
  created_at: string;
  updated_at: string;
  deleted_at?: string | null;
}
```

#### 🛠️ `UpdateCalendarEventRequest`

```ts
interface UpdateCalendarEventRequest {
  title?: string;
  description?: string;
  start_time?: string; // maintain uniform naming
  end_time?: string;
  location?: string;
  event_type?: "holiday" | "exam" | "meeting" | "other";
  target_roles?: ("Student" | "Teacher" | "Parent" | "Admin" | "SuperAdmin")[];
  target_classes?: string[];
  target_sections?: string[];
  is_all_day?: boolean;
  metadata?: Record<string, any>;
}
```

#### ✅ `EventParticipantsResponse`

```ts
interface EventParticipantsResponse {
  event_id: string;
  participants: {
    user_id: string;
    role: string;
    joined_at: string;
  }[];
}
```

#### 🛠️ `AddEventParticipantsRequest`

```ts
interface AddEventParticipantsRequest {
  user_ids: string[];
}
```

#### ✅ `SchoolDayConfigResponse`

```ts
interface SchoolDayConfigResponse {
  id: string;
  academic_year_id: string;
  school_start_time: string; // "08:00"
  school_end_time: string; // "15:00"
  working_days: string[]; // ["Monday", ...]
  holidays: string[]; // ISO dates
  created_at: string;
  updated_at: string;
}
```

#### 🛠️ `UpdateSchoolDayConfigRequest`

```ts
interface UpdateSchoolDayConfigRequest {
  school_start_time?: string;
  school_end_time?: string;
  working_days?: string[];
  holidays?: string[];
}
```

---

### ⚠️ Standard Error Object

```ts
interface ErrorResponse {
  statusCode: number;
  error: string; // e.g., "Bad Request"
  message: string; // details
  code?: string; // e.g., EVENT_NOT_FOUND
}
```

---

### 🔐 Security Headers

```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
X-Request-ID: <uuid>   # optional
```

---

### 🔗 Notes on Relations

- **Uniform naming**: only `start_time` / `end_time` appear in API & DB.
- Events may target roles, classes, sections; participants table links users.
- `school_day_config` scoped by `academic_year_id`.
- Soft-deletes via `deleted_at`.

---

### ✅ Role Constraints

| Role                   | Key Permissions                                    |
| ---------------------- | -------------------------------------------------- |
| **Admin / SuperAdmin** | Full CRUD on events & configs                      |
| **Teacher**            | Manage events they create; add/remove participants |
| **Parent / Student**   | View assigned events only                          |

---

### 📋 Sample Flow

**Create Holiday**

```http
POST /events
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "Winter Break",
  "description": "School closed",
  "start_time": "2025-12-20T00:00:00Z",
  "end_time": "2026-01-05T23:59:59Z",
  "event_type": "holiday",
  "is_all_day": true,
  "target_roles": ["Student", "Teacher", "Parent"]
}
```

Response → `CalendarEventResponse` with matching `start_time` / `end_time`.

---
