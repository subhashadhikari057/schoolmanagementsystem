## üìò API Contract ‚Äî `Academics Module`

> Version: `v1`  
> Base Path: `/api/v1/academics`  
> Auth Required: ‚úÖ Yes (JWT)  
> Roles Permitted: **Admin**, **SuperAdmin**, **Teacher**, **Student**, **Parent**

---

### üîê Access Control Rules

| Action                           | Role               | Scope                                |
| -------------------------------- | ------------------ | ------------------------------------ |
| List classes                     | All roles          | All (read-only where applicable)     |
| Create / update / delete classes | Admin / SuperAdmin | Full permissions                     |
| List sections                    | All roles          | All                                  |
| Manage sections                  | Admin / SuperAdmin | Full control                         |
| List subjects                    | All roles          | Scoped by school / class / section   |
| Assign subjects                  | Admin              | Scoped to school or academic year    |
| Teacher views assignments        | Teacher            | Own assigned classes / subjects only |
| Student views assignments        | Student            | Own class / section / subjects       |
| Create / edit assignments        | Teacher            | Scoped to assigned class / subject   |
| Submit assignments               | Student            | Own submissions only                 |
| Grade / review submissions       | Teacher            | Their assigned classes only          |

---

### üìö Endpoint Catalog

| Method | Path                                          | Description                         | Roles Allowed         |
| ------ | --------------------------------------------- | ----------------------------------- | --------------------- |
| GET    | `/classes`                                    | List all academic classes           | All roles             |
| POST   | `/classes`                                    | Create a new class                  | Admin, SuperAdmin     |
| PUT    | `/classes/:id`                                | Update class info                   | Admin, SuperAdmin     |
| DELETE | `/classes/:id`                                | Soft-delete class                   | Admin, SuperAdmin     |
| GET    | `/sections?class_id=...`                      | List sections under a class         | All roles             |
| POST   | `/sections`                                   | Create section                      | Admin, SuperAdmin     |
| PUT    | `/sections/:id`                               | Update section                      | Admin, SuperAdmin     |
| DELETE | `/sections/:id`                               | Delete section                      | Admin, SuperAdmin     |
| GET    | `/subjects?class_id=...`                      | List subjects by class              | All roles             |
| POST   | `/subjects`                                   | Create subject                      | Admin                 |
| PUT    | `/subjects/:id`                               | Update subject                      | Admin                 |
| DELETE | `/subjects/:id`                               | Delete subject                      | Admin                 |
| GET    | `/assignments`                                | List assignments (supports filters) | Teacher, Student      |
| POST   | `/assignments`                                | Create assignment                   | Teacher               |
| GET    | `/assignments/:id`                            | Get assignment detail               | Teacher, Student      |
| PUT    | `/assignments/:id`                            | Update assignment                   | Teacher               |
| DELETE | `/assignments/:id`                            | Delete assignment                   | Teacher               |
| POST   | `/assignments/:id/submit`                     | Submit assignment                   | Student               |
| GET    | `/assignments/:id/submissions`                | View all submissions                | Teacher               |
| GET    | `/assignments/:id/submissions/:submission_id` | View single submission              | Teacher / own Student |
| PUT    | `/assignments/:id/submissions/:submission_id` | Grade submission                    | Teacher               |

---

### üßæ TypeScript Schemas

#### üõ†Ô∏è `CreateClassRequest`

```ts
interface CreateClassRequest {
  name: string; // e.g. "Grade 5"
  academic_year_id: string; // UUID FK
  order: number; // sorting
}
```

#### ‚úÖ `ClassResponse`

```ts
interface ClassResponse {
  id: string;
  name: string;
  academic_year_id: string;
  order: number;
  created_at: string;
  updated_at: string;
}
```

---

#### üõ†Ô∏è `CreateSectionRequest`

```ts
interface CreateSectionRequest {
  name: string;
  class_id: string; // FK
  assigned_teacher_id?: string; // optional teacher FK
}
```

#### ‚úÖ `SectionResponse`

```ts
interface SectionResponse {
  id: string;
  name: string;
  class_id: string;
  assigned_teacher_id?: string;
  created_at: string;
  updated_at: string;
}
```

---

#### üõ†Ô∏è `CreateSubjectRequest`

```ts
interface CreateSubjectRequest {
  name: string;
  code?: string;
  class_id: string;
  is_elective: boolean;
}
```

#### ‚úÖ `SubjectResponse`

```ts
interface SubjectResponse {
  id: string;
  name: string;
  code?: string;
  class_id: string;
  is_elective: boolean;
  created_at: string;
  updated_at: string;
}
```

---

#### üõ†Ô∏è `CreateAssignmentRequest`

```ts
interface CreateAssignmentRequest {
  title: string;
  description?: string;
  subject_id: string;
  class_id: string;
  section_id: string;
  due_date: string; // ISO 8601
  attachments?: string[]; // file IDs or URLs
}
```

#### ‚úÖ `AssignmentResponse`

```ts
interface AssignmentResponse {
  id: string;
  title: string;
  description?: string;
  subject_id: string;
  class_id: string;
  section_id: string;
  teacher_id: string;
  due_date: string;
  attachments?: string[];
  created_at: string;
  updated_at: string;
}
```

---

#### üõ†Ô∏è `SubmitAssignmentRequest`

```ts
interface SubmitAssignmentRequest {
  assignment_id: string;
  student_id: string;
  submitted_at: string;
  file_links: string[];
  notes?: string;
}
```

#### ‚úÖ `SubmissionResponse`

```ts
interface SubmissionResponse {
  id: string;
  assignment_id: string;
  student_id: string;
  submitted_at: string;
  file_links: string[];
  notes?: string;
  graded: boolean;
  grade?: string;
  feedback?: string;
  created_at: string;
  updated_at: string;
}
```

---

### ‚ö†Ô∏è Standard Error Object

```ts
interface ErrorResponse {
  statusCode: number;
  error: string; // HTTP status text
  message: string; // explanatory message
  code?: string; // domain-specific error code
}
```

---

### üîê Security Headers

```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
X-Request-ID: <uuid>
```

---

### üîó Notes on Relations

- `class_id` ‚Üí `academics.classes.id`
- `section_id` ‚Üí `academics.sections.id`
- `subject_id` / `assignment_id` follow FK rules from respective tables
- `submission` links via `student_id` + `assignment_id`
- All timestamps use ISO 8601 (UTC)

---

### üö´ JSONB Overuse Notice

> **Don‚Äôt store grading logic in JSONB.**  
> Keys such as `grading_scale`, `grade_thresholds`, or weighting data used in dashboards or filters **must** live in normalized tables.

Example relational design:

```sql
CREATE TABLE academics.grading_schemes (
  id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  assignment_id UUID            NOT NULL REFERENCES academics.assignments(id) ON DELETE CASCADE,
  grade_label   TEXT            NOT NULL,  -- e.g. 'A'
  min_score     NUMERIC(5,2)    NOT NULL,
  max_score     NUMERIC(5,2)    NOT NULL,
  UNIQUE (assignment_id, grade_label)
);
```

_Benefits_: type-safe querying, index support, no shape-mismatch in React components, faster reports.

---

### ‚úÖ Role Constraints + Guards

- **Admin / SuperAdmin** ‚Äì full CRUD on classes, sections, subjects
- **Teacher** ‚Äì manage own assignments & grade submissions
- **Student** ‚Äì view & submit own assignments
- **Parent** ‚Äì read-only metadata for their child; no grading data

---

### üìã Sample Flows

1. **Create Assignment**

```http
POST /assignments
Authorization: Bearer <teacher_token>
```

Body ‚Üí `CreateAssignmentRequest` ‚Üí returns `AssignmentResponse`.

2. **Submit Assignment**

```http
POST /assignments/:id/submit
Authorization: Bearer <student_token>
```

Body ‚Üí `SubmitAssignmentRequest` ‚Üí returns `SubmissionResponse`.

3. **Grade Submission**

```http
PUT /assignments/:id/submissions/:submission_id
Authorization: Bearer <teacher_token>
```

Body:

```json
{ "grade": "A", "feedback": "Well done!" }
```

Returns updated `SubmissionResponse`.

---
