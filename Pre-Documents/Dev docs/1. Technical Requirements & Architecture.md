## 🧭 **System Overview (Project Vision)**

Design and develop a **single-institution School Management System (SMS)** that empowers seamless operations for educational institutions by providing a **modular**, **secure**, and **scalable** platform. It serves diverse user roles—**students**, **parents**, **teachers**, **administrators**, and **super admins**—with clear boundaries of access and responsibility.

### 🎯 Core Goals

- **Modular architecture** enabling scalable and isolated development per domain (e.g., academics, attendance, finance).
- **Atomic Design (Atoms → Molecules → Organisms → Templates)** for frontend components.
- **Domain-Driven Design (DDD)** principles applied in backend service structuring.
- **Role-Based Access Control (RBAC)** and strict permission enforcement.
- Adherence to **modern security best practices**, performance optimizations, and clean developer onboarding.

---

## 🏗️ **Architecture Style: Modular Monolith + DDD**

### ✅ Why Modular Monolith?

A **modular monolith** is ideal for this LMS because:

- You're targeting a **single school** environment, not a multi-tenant SaaS.
- You need to support **multiple interrelated domains** (e.g., user management, exam grading, complaints).
- You want strong **developer productivity** without the complexity of microservices.
- The system will be containerized and scalable as a single artifact, simplifying deployment and orchestration.

| Layer              | Detail                                                                                                                           |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| **Frontend**       | Atomic Design hierarchy to maintain UI consistency and reusability                                                               |
| **Backend**        | Modular Monolith using **DDD** – each domain (Auth, Academics, Attendance, Finance, etc.) is isolated in its own bounded context |
| **Infrastructure** | Containerized backend (Docker), exposed via a secure REST API, with PostgreSQL as the primary datastore                          |
| **Security**       | JWT Auth + Role Context + Permission-based Filtering                                                                             |
| **Deployment**     | Monolith Docker image, CI/CD via GitHub Actions, with long-term cloud readiness                                                  |

---

## 🔐 **Authentication & Authorization Design**

### 🔒 Authentication (Session Security)

| Feature                  | Design                                                                 |
| ------------------------ | ---------------------------------------------------------------------- |
| **Access Token**         | JWT (short-lived, stateless)                                           |
| **Refresh Token**        | Stored in `httpOnly` cookie for renewal                                |
| **Mobile Token Binding** | (Optional) Device-bound tokens to prevent reuse across devices         |
| **Password Hashing**     | bcrypt with salt & pepper                                              |
| **Brute Force Defense**  | Rate-limiting and lockouts via middleware (e.g., Redis-backed limiter) |

### 🔑 Authorization (RBAC with Contextual Enforcement)

Roles are structured to limit and control access to data **by role and context**. This includes teacher-class assignments, parent-child relationships, and administrative domain responsibilities.

| Role                         | Sample Scope                                                   |
| ---------------------------- | -------------------------------------------------------------- |
| **Super Admin**              | Full control of all system modules                             |
| **Admin**                    | Access to assigned modules (attendance, fees, academics, etc.) |
| **Teacher**                  | Assigned classes/subjects only                                 |
| **Student**                  | Own data only                                                  |
| **Parent**                   | Data of their linked children only                             |
| **Finance Staff (sub-role)** | Access to payment modules but not exam results                 |

All access rules are enforced via:

- **Route guards** (based on JWT + claims)
- **Service-layer guards** (e.g., is this student assigned to this parent?)
- **Database-level scoping** (e.g., only show student records where `parent_id` matches)

---

## 📊 **Role & Permissions Matrix**

| Feature               | SuperAdmin | Admin | Teacher               | Parent            | Student |
| --------------------- | ---------- | ----- | --------------------- | ----------------- | ------- |
| View/Manage Students  | ✅         | ✅    | 🔶 (own class)        | 🔶 (own children) | ❌      |
| Submit/Approve Leaves | ❌         | ✅    | ✅                    | ✅                | ✅      |
| Mark/View Attendance  | ❌         | ✅    | ✅                    | 🔶                | 🔶      |
| Enter Exam Results    | ❌         | ✅    | ✅ (assigned class)   | ❌                | ❌      |
| View Assignments      | ❌         | ✅    | ✅                    | ✅                | ✅      |
| File Complaints       | ❌         | ❌    | ❌                    | ✅                | ✅      |
| Resolve Complaints    | ✅         | ✅    | 🔶 (if class teacher) | ❌                | ❌      |
| View Fee Payments     | ✅         | ✅    | ❌                    | ✅                | ❌      |
| Manage Users          | ✅         | ✅    | ❌                    | ❌                | ❌      |

> 🔶 = Contextual (e.g., based on class, child, or subject assignment)

These permissions will be centrally defined in:

- `roles-permissions.config.ts`
- Enforced via middleware (`withRoleGuard`, `hasPermission`)
- Sourced dynamically from DB for future flexibility

---

## 🗺️ **Key Architectural Diagrams**

1. ### 📦 Component Diagram
   - Visual breakdown of modules like:
     - `AuthModule`
     - `StudentModule`
     - `TeacherModule`
     - `ExamModule`
     - `ComplaintModule`
     - `FeeModule`
   - Shows interface boundaries and external integrations (e.g., file upload, email service)

2. ### 🔁 Data Flow Diagram
   - Example: _Student submits assignment → validated → stored → teacher notified → feedback loop_
   - Tracks request lifecycle across frontend → backend → DB → response/UI feedback

3. ### 🔄 Sequence Diagrams

   #### a. Parent logs in and switches between children

   #### b. Teacher marks attendance and submits to backend

   #### c. Admin posts results → student views report card

---

## ✅ Optional Enhancements (Implemented)

| Feature                  | Purpose                                                                                                                 |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------- |
| **Granular Permissions** | Role sub-types like “Exam Admin”, “Fee Clerk” with limited views/actions                                                |
| **Mobile Token Binding** | Enhance session security in mobile apps                                                                                 |
| **Audit Trails**         | Track sensitive operations (fee edits, result updates, role changes) in `audit_logs` table with actor/timestamp details |

---

## ⚠️ Common Assumptions (Debunked)

| Assumption                          | Risk                                                                                                            |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| "Parents only have one child"       | ❌ Multi-child switching already supported – queries must join via junction table                               |
| "Teachers don’t overlap subjects"   | ❌ Teachers may have many-to-many relations with classes and subjects                                           |
| "JWT is enough"                     | ❌ Implement refresh token rotation, CSRF protection on sensitive endpoints, and session invalidation on logout |
| "Modular monoliths are always easy" | ⚠️ Without strict module boundaries, can become unmaintainable – isolate `domain services` carefully            |

---

## 🧠 Final Notes

This document captures **only the foundation**. To ensure long-term project success:

- Treat **each module as a mini-service** with its own:
  - Routes
  - Interfaces
  - Logic
- Never bypass **domain boundaries** or duplicate logic.
- Maintain strict separation of **concerns and responsibilities** (especially for frontend state and backend services).
