---

## üöÄ Overview: Stack Objectives

| Objective                  | Strategy                                                                                                                                   |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| **Modularity**            | Interface + DI boundaries; no shared state between modules unless explicitly exposed via contracts                                         |
| **Security**              | Principle of Least Privilege (PoLP); tokenized role-auth; Zod-level validation at all layers; PostgreSQL-level row- and column-level security |
| **Performance**           | Async I/O across all services; code-splitting (frontend); indexes & materialized views (Postgres); API caching (Redis or HTTP cache)        |
| **Scalability**           | Stateless backend; composable micro-modules; feature-boundary enforced monolith with microservices optional                                 |
| **Maintainability**       | Linting, CI/CD enforcement, semantic commits, atomic UI design, thin controllers, clean separation of concerns                              |

---

## üß† 1. **Backend Stack (Node.js + TypeScript + NestJS)**

> _Structured around DDD principles: Domain Layer, Application Layer, Infrastructure Layer._

### üì¶ Core Stack

| Area         | Tech/Library                     | Purpose                                                       |
| ------------ | -------------------------------- | ------------------------------------------------------------- |
| Language     | TypeScript (strict mode)         | Type safety, static contracts                                 |
| Framework    | NestJS                           | DI container, layered structure, modular enforcement          |
| Auth & RBAC  | `@nestjs/passport`, JWT          | Multi-role identity w/ scopes, custom decorators, and guards  |
| ORM          | Prisma ORM                       | Type-safe DB layer, schema-first, migration enforcement       |
| Validation   | Zod                              | Functional + composable schema validation with DTO decoupling |
| Caching      | Redis (via `ioredis`)            | Caching expensive queries, rate limiting, session store       |
| Uploads      | Multer (local) or S3             | Multipart handling with S3 integration abstraction            |
| Queue System | BullMQ (Redis-backed)            | Async jobs (e.g., emails, attendance imports)                 |
| Testing      | Jest + Supertest                 | Unit and integration test framework                           |
| Logging      | Pino + Winston adapter           | Structured, async-friendly logging                            |
| Env Config   | `@nestjs/config` + `dotenv-safe` | Typed and validated env vars                                  |
| Security     | Helmet, CORS, RateLimiter        | Basic HTTP-level protections                                  |

---

### üõ°Ô∏è Security Practices (Backend)

| Concern                  | Solution                                                                                       |
| ------------------------ | ---------------------------------------------------------------------------------------------- |
| **Injection protection** | Zod for schema validation; parameterized Prisma queries                                        |
| **Module isolation**     | Never expose internal domain logic; services only accessible via defined interfaces            |
| **Token security**       | JWT with exp + refresh rotation (via cookie/httpOnly header)                                   |
| **RBAC**                 | Role guards per route/module; policy wrappers injected per use-case layer                      |
| **Data protection**      | Field-level filtering at Prisma layer based on role context                                    |
| **Rate limiting**        | Redis-backed global and per-route limiters                                                     |
| **Audit logging**        | Pino structured logs with event audit layer (optional Kafka queue integration for audit trail) |

---

### üìê API Style

| Mode        | Use Case                                                                     |
| ----------- | ---------------------------------------------------------------------------- |
| REST (main) | Most CRUD operations, simpler traceability                                   |
| GraphQL     | _Optional_ for complex read views (e.g., attendance matrix UI)               |
| gRPC        | _Optional_ for internal module comms (can be mocked via interface contracts) |

---

### üîÅ Dependency Management

All modules are registered in `AppModule` via NestJS DI. Only public interfaces can be injected. Internal domain logic never imported cross-module.

```ts
@Module({
  providers: [
    {
      provide: "IStudentRepository",
      useClass: PrismaStudentRepository,
    },
  ],
})
export class StudentModule {}
```

---

## üíª 2. **Frontend Stack (React + TypeScript + Tailwind + App Router)**

> _Atomic-first, role-scoped layouts, no feature logic in global UI components._

### üß© Core Stack

| Area             | Tech/Library                | Purpose                                                            |
| ---------------- | --------------------------- | ------------------------------------------------------------------ |
| Language         | TypeScript                  | Type safety + prop contracts                                       |
| Framework        | Next.js (App Router)        | Layout composability + page-level boundaries                       |
| UI Library       | Headless UI + Tailwind      | Fully composable components, perfect for role-based design systems |
| Styling          | TailwindCSS + DaisyUI (opt) | Utility-first theming, responsive design                           |
| State Management | Zustand (or Redux Toolkit)  | Small, local state; global auth/session only                       |
| Form Handling    | React Hook Form + Zod       | Validation co-location + minimal rerenders                         |
| Data Fetching    | React Query (TanStack)      | Caching, background fetch, pagination, stale revalidation          |
| Testing          | Vitest + React Testing Lib  | Unit + UI coverage                                                 |
| Auth             | JWT from HttpOnly cookie    | CSR with protected routes via useAuth() hook                       |

---

### üß± Frontend Architecture Support

| Enforcement                      | Method                                                                       |
| -------------------------------- | ---------------------------------------------------------------------------- |
| **Atomic design**                | atoms ‚Üí molecules ‚Üí organisms ‚Üí templates ‚Üí pages                            |
| **Modular features**             | `features/student`, `features/attendance` ‚Äî match backend module boundaries  |
| **Role-driven UI**               | `useAuth`, `roleContext`, and `getLayout()` patterns in App Router           |
| **Validation**                   | `zodSchema.ts` per DTO from backend, fully typed                             |
| **Access control (client-side)** | Route guards + layout-level boundary via `middleware.ts` or context redirect |

---

### üõ°Ô∏è Security Practices (Frontend)

| Threat                        | Solution                                                                            |
| ----------------------------- | ----------------------------------------------------------------------------------- |
| **XSS/CSRF**                  | HttpOnly cookies, no localStorage, strict CSP headers                               |
| **Sensitive state exposure**  | Never store auth tokens in React state                                              |
| **Role spoofing**             | Server-side role injection and double validation in frontend                        |
| **Form abuse**                | ReCAPTCHA or hCaptcha layer for sensitive actions (e.g., feedback form, complaints) |
| **Session hijack protection** | Use short-lived tokens + refresh strategy                                           |

---

## üß© 3. **Database Stack (PostgreSQL)**

> _Normalized, indexed, and encrypted where needed. Aligned to domain models, not flat user-tables._

### ‚öôÔ∏è Tech Stack

| Tool           | Use                                         |
| -------------- | ------------------------------------------- |
| PostgreSQL 15+ | Main relational database                    |
| Prisma ORM     | Schema-driven model management + migrations |

---

### üß† DB Design Conventions

| Principle              | Practice                                                                             |
| ---------------------- | ------------------------------------------------------------------------------------ |
| **Role-aware queries** | Views scoped to role permissions or row-level security                               |
| **No logic in DB**     | Use Prisma to expose logic to application layer                                      |
| **Normalized schemas** | Avoids duplicated data; aggregates computed in view or materialized view             |
| **Encrypted fields**   | Personally identifiable info (PII) stored with field-level AES encryption            |
| **Soft deletes**       | Every entity has `deletedAt` timestamp (no hard deletion unless archive is required) |

---

### üß∞ Tables & Relationships (High-Level)

- `users` ‚Üí `roles` (one-to-many)
- `students` ‚Üí `parents`, `classes`, `attendance_records`
- `teachers` ‚Üí `subjects`, `classes`, `timetables`
- `exams`, `results`, `complaints`, `announcements`, `notifications` ‚Üí all related via `user_id` and role context
- Join tables where needed (`student_class`, `teacher_subject`) for M:N mappings

---
