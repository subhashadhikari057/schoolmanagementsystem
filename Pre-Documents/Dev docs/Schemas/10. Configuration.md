### üóÇÔ∏è Tables Overview:

| Table Name         | Purpose                                                               |
| ------------------ | --------------------------------------------------------------------- |
| `school_profile`   | Core information about the school (name, address, branding)           |
| `academic_years`   | Academic years with timeline and active status                        |
| `grading_policies` | Defines grading scales and rules per academic year/program            |
| `subject_mappings` | Links subjects to academic years, programs, and curricular structures |

---

## üìÑ Schema Definitions (PostgreSQL + SQL DDL)

---

### üè´ `school_profile`

```sql
CREATE TABLE configuration.school_profile (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    school_name        VARCHAR(255) NOT NULL,
    registration_number VARCHAR(100) UNIQUE,
    address            TEXT,
    city               VARCHAR(100),
    state              VARCHAR(100),
    postal_code        VARCHAR(20),
    country            VARCHAR(100),

    phone    VARCHAR(20),
    email    VARCHAR(255),
    website  VARCHAR(255),

    logo_url    TEXT,
    favicon_url TEXT,

    timezone VARCHAR(50) DEFAULT 'UTC',

    contact_person_name  VARCHAR(150),
    contact_person_email VARCHAR(255),
    contact_person_phone VARCHAR(20),

    operational_status BOOLEAN DEFAULT TRUE,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_school_profile_name              ON configuration.school_profile(school_name);
CREATE INDEX idx_school_profile_city              ON configuration.school_profile(city);
CREATE INDEX idx_school_profile_operational_status ON configuration.school_profile(operational_status);
```

---

### üìÖ `academic_years`

```sql
CREATE TABLE configuration.academic_years (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    school_id UUID NOT NULL REFERENCES configuration.school_profile(id) ON DELETE CASCADE,

    year_label VARCHAR(50) NOT NULL,  -- e.g., "2024-2025"
    start_date DATE NOT NULL,
    end_date   DATE NOT NULL,

    is_current  BOOLEAN DEFAULT FALSE,
    is_archived BOOLEAN DEFAULT FALSE,

    description TEXT,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE UNIQUE INDEX uq_academic_years_school_year_label ON configuration.academic_years(school_id,year_label);
CREATE INDEX idx_academic_years_current                 ON configuration.academic_years(is_current);
CREATE INDEX idx_academic_years_dates                   ON configuration.academic_years(start_date,end_date);
```

---

### üìù `grading_policies`

```sql
CREATE TABLE configuration.grading_policies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    academic_year_id UUID NOT NULL REFERENCES configuration.academic_years(id) ON DELETE CASCADE,

    policy_name VARCHAR(100) NOT NULL,

    grading_scale JSONB NOT NULL,        -- [{ "grade":"A", "min":90, "max":100 }, ‚Ä¶]
    passing_score NUMERIC(5,2) DEFAULT 50.00,

    config_type   VARCHAR(50) DEFAULT 'standard',  -- 'standard','custom', etc.
    default_value BOOLEAN      DEFAULT FALSE,       -- TRUE = system-wide default

    description TEXT,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_grading_policies_name          ON configuration.grading_policies(policy_name);
CREATE INDEX idx_grading_policies_academic_year ON configuration.grading_policies(academic_year_id);
```

---

### üîó `subject_mappings`

```sql
CREATE TABLE configuration.subject_mappings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    subject_id      UUID NOT NULL REFERENCES academics.subjects(id)          ON DELETE CASCADE,
    academic_year_id UUID NOT NULL REFERENCES configuration.academic_years(id) ON DELETE CASCADE,
    program_id      UUID,  -- optional FK

    mandatory BOOLEAN DEFAULT TRUE,

    custom_metadata JSONB,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id),

    UNIQUE(subject_id,academic_year_id,program_id)
);

CREATE INDEX idx_subject_mappings_subject       ON configuration.subject_mappings(subject_id);
CREATE INDEX idx_subject_mappings_academic_year ON configuration.subject_mappings(academic_year_id);
```

---

## üìå Design Notes & Rationale

- **Typed flags** ‚Äì `config_type` and `default_value` are now first-class columns, eliminating JSONB parsing and type-casting bugs in APIs, analytics and BI tools.
- **JSONB** kept only for flexible fields (`grading_scale`, `custom_metadata`), avoiding query-critical data there.
- **Audit & soft-delete** columns across all tables maintain compliance and rollback capabilities.
- **Indexes** ensure quick look-ups on status, year ranges, and core foreign keys.

---
