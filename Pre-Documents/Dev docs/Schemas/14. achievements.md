### üóÇÔ∏è Tables Overview:

| Table Name             | Purpose                                         |
| ---------------------- | ----------------------------------------------- |
| `certificates`         | Stores metadata of certificates issued          |
| `badges`               | Stores badge definitions and metadata           |
| `student_achievements` | Links students to earned certificates or badges |

---

## üìÑ Schema Definitions (PostgreSQL + SQL DDL)

---

### üéì `certificates`

```sql
CREATE TABLE achievements.certificates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    title VARCHAR(255) NOT NULL,
    description TEXT,
    issuer VARCHAR(255),                   -- e.g., "School Board", "Math Dept."
    issue_date DATE NOT NULL,
    valid_until DATE,                      -- Optional expiration date for validity

    template_url TEXT,                     -- URL for certificate template (optional)
    additional_metadata JSONB,             -- For extensible fields (e.g., QR codes)

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_certificates_title ON achievements.certificates(title);
CREATE INDEX idx_certificates_issue_date ON achievements.certificates(issue_date);
```

---

### üèÖ `badges`

```sql
CREATE TABLE achievements.badges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    name VARCHAR(150) NOT NULL UNIQUE,
    description TEXT,
    badge_icon_url TEXT,                  -- Updated to match schema/API naming consistency
    category VARCHAR(100),                -- e.g., "Academic", "Sports", "Behavior"
    criteria TEXT,                        -- Textual criteria for earning the badge

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_badges_category ON achievements.badges(category);
CREATE INDEX idx_badges_name ON achievements.badges(name);
```

---

### üßë‚Äçüéì `student_achievements`

```sql
CREATE TABLE achievements.student_achievements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    student_id UUID NOT NULL REFERENCES student.students(id) ON DELETE CASCADE,

    achievement_type VARCHAR(20) NOT NULL CHECK (achievement_type IN ('certificate', 'badge')),
    certificate_id UUID REFERENCES achievements.certificates(id) ON DELETE SET NULL,
    badge_id UUID REFERENCES achievements.badges(id) ON DELETE SET NULL,

    awarded_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    awarded_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    remarks TEXT,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,

    CHECK (
      (achievement_type = 'certificate' AND certificate_id IS NOT NULL AND badge_id IS NULL)
      OR
      (achievement_type = 'badge' AND badge_id IS NOT NULL AND certificate_id IS NULL)
    )
);

CREATE INDEX idx_student_achievements_student ON achievements.student_achievements(student_id);
CREATE INDEX idx_student_achievements_awarded_at ON achievements.student_achievements(awarded_at);
CREATE INDEX idx_student_achievements_type ON achievements.student_achievements(achievement_type);
```

---

## üìå Indexing & Performance Notes

- Indexed `title`, `name`, and `category` fields for fast lookups.
- Student achievements indexed by student ID and awarded date to quickly query student history.
- Integrity enforced via a CHECK constraint to avoid ambiguous achievement links.
- Soft delete and audit fields enable traceability and logical deletes.

---

## üîê Auditing & Soft-Delete Considerations

- All tables include `created_by`, `updated_by`, and `deleted_by` foreign keys referencing `auth.users`.
- Timestamps (`created_at`, `updated_at`, `deleted_at`) enable full lifecycle tracking and compliance.
- Cascading deletes on student links ensure data integrity.

---
