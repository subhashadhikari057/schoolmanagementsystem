### üóÇÔ∏è Tables Overview:

|Table Name|Purpose|
|---|---|
|`exams`|Represents exam events like Mid-terms, Finals (schedule + meta)|
|`exam_sessions`|Per-exam sittings or sessions (e.g., morning / afternoon)|
|`results`|Student results per session with marks, grades, remarks|
|`grades`|Grading-scale definitions (e.g., A, B, C) and associated mark ranges|

---

## üìÑ Schema Definitions (PostgreSQL + SQL DDL)

---

### üîß **ENUMs**

```sql
-- Exam status lifecycle
CREATE TYPE exam_status AS ENUM ('scheduled', 'ongoing', 'completed', 'cancelled');
```

---

### üìÖ `exams`

```sql
CREATE TABLE exam.exams (
    id               UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name             VARCHAR(150) NOT NULL,          -- e.g. "Mid-Term 2025"
    description      TEXT,

    academic_year_id UUID NOT NULL
                         REFERENCES configuration.academic_years(id)
                         ON DELETE RESTRICT,

    -- üöö Moved out of `additional_metadata` so it‚Äôs filterable/reportable
    term             VARCHAR(50) NOT NULL,           -- e.g. "First", "Second", "Final"

    start_date       TIMESTAMPTZ NOT NULL,
    end_date         TIMESTAMPTZ NOT NULL,

    status           exam_status DEFAULT 'scheduled', -- scheduled | ongoing | completed | cancelled
    additional_metadata JSONB DEFAULT '{}',          -- only non-critical extras

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id),

    CONSTRAINT unique_exam_per_year UNIQUE (name, academic_year_id)
);

-- üîé Indexes
CREATE INDEX idx_exams_academic_year ON exam.exams(academic_year_id);
CREATE INDEX idx_exams_term          ON exam.exams(term);
CREATE INDEX idx_exams_status        ON exam.exams(status);
CREATE INDEX idx_exams_created_by    ON exam.exams(created_by);
CREATE INDEX idx_exams_updated_by    ON exam.exams(updated_by);
CREATE INDEX idx_exams_deleted_by    ON exam.exams(deleted_by);
```

---

### üïí `exam_sessions`

```sql
CREATE TABLE exam.exam_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    exam_id      UUID NOT NULL
                   REFERENCES exam.exams(id) ON DELETE CASCADE,

    session_name VARCHAR(100) NOT NULL,          -- "Morning Session"
    start_time   TIMESTAMPTZ NOT NULL,
    end_time     TIMESTAMPTZ NOT NULL,
    location     VARCHAR(255),

    additional_metadata JSONB DEFAULT '{}',

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id),

    CONSTRAINT unique_session_per_exam UNIQUE (exam_id, session_name)
);

CREATE INDEX idx_exam_sessions_exam_id   ON exam.exam_sessions(exam_id);
CREATE INDEX idx_exam_sessions_created_by ON exam.exam_sessions(created_by);
CREATE INDEX idx_exam_sessions_updated_by ON exam.exam_sessions(updated_by);
CREATE INDEX idx_exam_sessions_deleted_by ON exam.exam_sessions(deleted_by);
```

---

### üìä `results`

```sql
CREATE TABLE exam.results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    student_id      UUID NOT NULL
                       REFERENCES student.students(id) ON DELETE CASCADE,
    exam_session_id UUID NOT NULL
                       REFERENCES exam.exam_sessions(id) ON DELETE CASCADE,

    marks_obtained  NUMERIC(5,2),                -- use NUMERIC for precision
    grade_id        UUID REFERENCES exam.grades(id),
    remarks         TEXT,
    is_passed       BOOLEAN DEFAULT FALSE,

    additional_metadata JSONB DEFAULT '{}',

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id),

    CONSTRAINT unique_result_per_student_session
        UNIQUE (student_id, exam_session_id)
);

CREATE INDEX idx_results_student       ON exam.results(student_id);
CREATE INDEX idx_results_exam_session  ON exam.results(exam_session_id);
CREATE INDEX idx_results_grade         ON exam.results(grade_id);
CREATE INDEX idx_results_created_by    ON exam.results(created_by);
CREATE INDEX idx_results_updated_by    ON exam.results(updated_by);
CREATE INDEX idx_results_deleted_by    ON exam.results(deleted_by);
```

---

### üèÖ `grades`

```sql
CREATE TABLE exam.grades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    code       VARCHAR(10) UNIQUE NOT NULL,    -- "A+", "B"
    min_mark   NUMERIC(5,2) NOT NULL,
    max_mark   NUMERIC(5,2) NOT NULL,
    description TEXT,
    grade_point NUMERIC(3,2),                  -- optional GPA equivalent

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_grades_code       ON exam.grades(code);
CREATE INDEX idx_grades_created_by ON exam.grades(created_by);
CREATE INDEX idx_grades_updated_by ON exam.grades(updated_by);
CREATE INDEX idx_grades_deleted_by ON exam.grades(deleted_by);
```

---

## üìå Design Highlights & Best Practices

- **`term` is now a first-class column** ‚Üí simple `WHERE term = 'Final'` filters, cleaner analytics.
    
- **JSONB only for low-importance or future-proof fields**.
    
- **Strict auditing** (`created_at`, `updated_at`, `deleted_at` + user FKs) across all tables.
    
- **NUMERIC for `marks_obtained`** ensures exact score representation.
    
- **Soft deletes** everywhere via nullable `deleted_at`.
    
- **Comprehensive indexing** on filterable and FK columns to keep queries snappy.