
### üóÇÔ∏è Tables Overview:

|Table Name|Purpose|
|---|---|
|`forums`|Container for discussion topics/categories|
|`forum_threads`|Discussion threads within a forum|
|`forum_posts`|Individual posts/messages inside threads|
|`moderation_flags`|Flags and actions for moderation purposes|

---

## üìÑ Schema Definitions (PostgreSQL + SQL DDL)

---

### üóÉÔ∏è `forums`

```sql
CREATE TABLE forum.forums (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    name VARCHAR(150) UNIQUE NOT NULL,           -- Forum name, e.g. "General Discussion"
    description TEXT,                            -- Brief overview of forum purpose
    is_active BOOLEAN DEFAULT TRUE,              -- Active/inactive toggle
    
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,
    
    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_forums_name ON forum.forums(name);
CREATE INDEX idx_forums_is_active ON forum.forums(is_active);
```

---

### üí¨ `forum_threads`

```sql
CREATE TABLE forum.forum_threads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    forum_id UUID NOT NULL REFERENCES forum.forums(id) ON DELETE CASCADE,
    created_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE SET NULL,
    
    title VARCHAR(255) NOT NULL,
    is_locked BOOLEAN DEFAULT FALSE,             -- Lock thread for new posts
    is_pinned BOOLEAN DEFAULT FALSE,             -- Pin thread to top
    
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,
    
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_forum_threads_forum_id ON forum.forum_threads(forum_id);
CREATE INDEX idx_forum_threads_created_by ON forum.forum_threads(created_by);
CREATE INDEX idx_forum_threads_is_locked ON forum.forum_threads(is_locked);
CREATE INDEX idx_forum_threads_is_pinned ON forum.forum_threads(is_pinned);
```

---

### üìù `forum_posts`

```sql
CREATE TABLE forum.forum_posts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    thread_id UUID NOT NULL REFERENCES forum.forum_threads(id) ON DELETE CASCADE,
    created_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE SET NULL,
    
    content TEXT NOT NULL,
    is_edited BOOLEAN DEFAULT FALSE,
    edited_at TIMESTAMPTZ,
    
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,
    
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    deleted_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_forum_posts_thread_id ON forum.forum_posts(thread_id);
CREATE INDEX idx_forum_posts_created_by ON forum.forum_posts(created_by);
CREATE INDEX idx_forum_posts_is_edited ON forum.forum_posts(is_edited);
```

---

### üö© `moderation_flags`

```sql
-- Create ENUM for moderation status
CREATE TYPE forum.moderation_status_enum AS ENUM ('pending', 'approved', 'rejected', 'escalated', 'dismissed');

CREATE TABLE forum.moderation_flags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    flagged_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE SET NULL,
    target_type VARCHAR(50) NOT NULL,             -- e.g., 'forum_post', 'forum_thread', 'user'
    target_id UUID NOT NULL,                       -- ID of the flagged entity
    
    reason TEXT NOT NULL,                          -- Reason for flagging
    status forum.moderation_status_enum NOT NULL DEFAULT 'pending',
    action_taken TEXT,                             -- Moderator notes/actions
    
    created_at TIMESTAMPTZ DEFAULT now(),
    reviewed_at TIMESTAMPTZ,
    
    reviewed_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    
    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    updated_at TIMESTAMPTZ,
    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL
);

CREATE INDEX idx_moderation_flags_target ON forum.moderation_flags(target_type, target_id);
CREATE INDEX idx_moderation_flags_status ON forum.moderation_flags(status);
CREATE INDEX idx_moderation_flags_flagged_by ON forum.moderation_flags(flagged_by);
CREATE INDEX idx_moderation_flags_reviewed_by ON forum.moderation_flags(reviewed_by);
```

---

## üìå Indexing & Performance Notes

- Indexes on foreign keys (`forum_id`, `thread_id`, `created_by`) ensure fast joins and lookups.
    
- Flagging table uses compound index for target lookups, and status filtering for efficient moderation queues.
    
- Soft-deletion columns (`deleted_at`) present in all main tables to allow safe recovery and logical deletion.
    

---

## üîê Auditing & Soft-Delete Considerations

- Each table has `created_by`, `updated_by`, and `deleted_by` fields referencing `auth.users(id)` with `ON DELETE SET NULL`.
    
- Timestamps for create, update, delete, and review enable traceability and compliance.
    
- Moderation flags are designed for immutable logging of moderation lifecycle with review tracking.
    

---
