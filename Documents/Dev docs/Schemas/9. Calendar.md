
### üóÇÔ∏è Tables Overview:

|Table Name|Purpose|
|---|---|
|`calendar_events`|Scheduled events on the school calendar|
|`event_participants`|Linking users/groups to events with roles|
|`school_day_config`|Configurations for school days, holidays, and sessions|

---

## üìÑ Schema Definitions (PostgreSQL + SQL DDL)

---

### üìÖ `calendar_events`

```sql
CREATE TABLE calendar.calendar_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    title       VARCHAR(255) NOT NULL,
    description TEXT,

    event_type  VARCHAR(50),                       -- e.g., 'holiday','exam','assembly'
    start_time  TIMESTAMPTZ NOT NULL,
    end_time    TIMESTAMPTZ NOT NULL,

    location    VARCHAR(255),

    is_all_day   BOOLEAN DEFAULT FALSE,
    is_recurring BOOLEAN DEFAULT FALSE,

    recurrence_pattern JSONB,                      -- {"freq":"weekly","interval":1,"byday":["MO","WE"]}

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_calendar_events_start_end ON calendar.calendar_events(start_time,end_time);
CREATE INDEX idx_calendar_events_type      ON calendar.calendar_events(event_type);
CREATE INDEX idx_calendar_events_all_day   ON calendar.calendar_events(is_all_day);
```

---

### üë• `event_participants`

```sql
CREATE TABLE calendar.event_participants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    event_id UUID NOT NULL REFERENCES calendar.calendar_events(id) ON DELETE CASCADE,
    user_id  UUID NOT NULL REFERENCES auth.users(id)              ON DELETE CASCADE,

    role VARCHAR(50) DEFAULT 'attendee',          -- 'organizer','speaker',...

    joined_at TIMESTAMPTZ DEFAULT now(),
    left_at   TIMESTAMPTZ,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id),

    UNIQUE(event_id,user_id)
);

CREATE INDEX idx_event_participants_event ON calendar.event_participants(event_id);
CREATE INDEX idx_event_participants_user  ON calendar.event_participants(user_id);
```

---

### üè´ `school_day_config`

```sql
CREATE TABLE calendar.school_day_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    academic_year UUID NOT NULL REFERENCES configuration.academic_years(id),

    day_date      DATE NOT NULL UNIQUE,
    is_school_day BOOLEAN DEFAULT TRUE,

    day_type VARCHAR(50),                       -- 'regular','holiday','half_day','exam_day'
    notes    TEXT,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ,
    deleted_at TIMESTAMPTZ,

    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id),
    deleted_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_school_day_config_year_date ON calendar.school_day_config(academic_year,day_date);
CREATE INDEX idx_school_day_config_day_type  ON calendar.school_day_config(day_type);
```

---

## üìå Design Notes & Rationale

- **Unified `start_time` / `end_time`** columns ensure API & UI consistency (legacy `start_at` removed).
    
- Recurrence rules stored in `recurrence_pattern` JSONB for flexible future schedules.
    
- `event_participants` cleanly separates user roles and join/leave timestamps.
    
- `school_day_config` centralises per-date school rules (holidays, half-days, etc.).
    
- Soft-delete + audit (`deleted_at`, `created_by`, `updated_by`, `deleted_by`) across all tables.
    
- Indexes cover date-range searches, type filters, and foreign-key joins for fast calendar queries.
    

---